package com.vk2.touchsreentab.model.datasource;import android.arch.lifecycle.MutableLiveData;import android.arch.paging.PageKeyedDataSource;import android.content.Context;import android.support.annotation.NonNull;import android.util.Log;import com.google.gson.Gson;import com.vk2.touchsreentab.api.Api;import com.vk2.touchsreentab.api.ApiController;import com.vk2.touchsreentab.api.Callback;import com.vk2.touchsreentab.api.CompositeManager;import com.vk2.touchsreentab.database.entity.Song;import com.vk2.touchsreentab.model.ResultSong;import com.vk2.touchsreentab.model.api.SongForm;import com.vk2.touchsreentab.utils.Constants;import com.vk2.touchsreentab.utils.SaveDataUtils;import com.vk2.touchsreentab.utils.Utils;import java.util.List;import io.reactivex.Observable;import io.reactivex.Observer;import io.reactivex.android.schedulers.AndroidSchedulers;import io.reactivex.disposables.Disposable;import io.reactivex.observers.DisposableObserver;import io.reactivex.schedulers.Schedulers;public class SongDataSource extends PageKeyedDataSource<Integer, Song> {    private Context context;    private int page = 1, limit = 15;    public MutableLiveData<Boolean> progressLiveStatus = new MutableLiveData<>();    SongDataSource(Context context) {        this.context = context;    }    @Override    public void loadInitial(@NonNull LoadInitialParams<Integer> params, @NonNull final LoadInitialCallback<Integer, Song> callback) {        progressLiveStatus.postValue(Constants.LOADING);        ApiController.getInstance().getHotSongs(context, page, limit, new Callback() {            @Override            public void response(Object obj) {                progressLiveStatus.postValue(!Constants.LOADING);                try {                    SongForm songForm = (SongForm) obj;                    if (songForm != null) {                        if (songForm.getErr() == ApiController.SUCCESS) {                            List<Song> songs = songForm.getData();                            if (songs != null) {                                songs.add(0, new Song());                                songs.add(0, new Song());                                callback.onResult(songs, page--, page++);                                page++;                            }                        }                    }                } catch (ClassCastException e) {                    e.printStackTrace();                }            }        });    }    @Override    public void loadBefore(@NonNull LoadParams<Integer> params, @NonNull LoadCallback<Integer, Song> callback) {    }    @Override    public void loadAfter(@NonNull LoadParams<Integer> params, @NonNull final LoadCallback<Integer, Song> callback) {        progressLiveStatus.postValue(Constants.LOADING);        ApiController.getInstance().getHotSongs(context, page, limit, new Callback() {            @Override            public void response(Object obj) {                progressLiveStatus.postValue(!Constants.LOADING);                try {                    SongForm songForm = (SongForm) obj;                    if (songForm != null) {                        if (songForm.getErr() == ApiController.SUCCESS) {                            List<Song> songs = songForm.getData();                            if (songs != null && songs.size() > 0) {                                callback.onResult(songs, page);                                page++;                            }                        }                    }                } catch (ClassCastException e) {                    e.printStackTrace();                }            }        });    }}